---
name: Live Testnet E2E (Optional)

"on":
  workflow_dispatch:
    inputs:
      network_profile:
        description: "Network profile to use (example: testnet11)"
        default: "testnet11"
        required: true
      dry_run:
        description: "Run in dry-run mode where possible"
        default: "true"
        required: true

jobs:
  live-testnet-e2e:
    runs-on: ubuntu-latest
    env:
      TESTNET_WALLET_MNEMONIC: ${{ secrets.TESTNET_WALLET_MNEMONIC }}
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install package
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e ".[dev]"

      - name: Validate config and run one daemon cycle
        run: |
          if [ -z "${TESTNET_WALLET_MNEMONIC:-}" ]; then
            echo "TESTNET_WALLET_MNEMONIC is not set; skipping optional live \
            testnet workflow."
            exit 0
          fi
          printf "1\n%s\n" "${TESTNET_WALLET_MNEMONIC}" | \
            greenfloor-manager \
              --program-config config/program.yaml \
              keys-onboard \
              --key-id key-main-1 \
              --state-dir ./.tmp-state
          greenfloor-manager \
            --program-config config/program.yaml \
            --markets-config config/markets.yaml \
            config-validate
          greenfloord \
            --program-config config/program.yaml \
            --markets-config config/markets.yaml \
            --once
